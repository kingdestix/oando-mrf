<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Oando MRF</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .analytics-header {
            background: linear-gradient(135deg, #00205B 0%, #003d8f 100%);
            color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .analytics-header h1 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .analytics-header p {
            margin: 0;
            opacity: 0.95;
            font-size: 0.9375rem;
        }
        
        .search-section {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-left: 4px solid #F58220;
        }
        
        .search-section h3 {
            color: #00205B;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .search-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            font-size: 0.9375rem;
            border: 2px solid #e5e5e5;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #00205B;
            box-shadow: 0 0 0 3px rgba(0, 32, 91, 0.1);
        }
        
        .kpi-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border-left: 4px solid #00205B;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .kpi-label {
            font-size: 0.75rem;
            color: #737373;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #00205B;
            line-height: 1;
        }
        
        .chart-card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            height: 100%;
            border-top: 3px solid #00205B;
        }
        
        .chart-card h3 {
            color: #00205B;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 1.25rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
        }
        
        .chart-container-large {
            height: 450px;
        }
        
        .filters-section {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-left: 4px solid #00205B;
        }
        
        .filters-section h3 {
            color: #00205B;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 1rem 0;
        }
        
        .material-breakdown-table {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 0.375rem;
            border: 1px solid #e5e5e5;
        }
        
        .material-breakdown-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .material-breakdown-table thead {
            position: sticky;
            top: 0;
            background: #00205B;
            color: white;
            z-index: 10;
        }
        
        .material-breakdown-table th {
            padding: 0.875rem 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.8125rem;
            white-space: nowrap;
        }
        
        .material-breakdown-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f3f3;
            font-size: 0.8125rem;
        }
        
        .material-breakdown-table tbody tr:hover {
            background: #fafafa;
        }
        
        .toggle-chart-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            background: #F58220;
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .toggle-chart-btn:hover {
            background: #EA532F;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 900px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
            
            .chart-container-large {
                height: 300px;
            }
            
            .kpi-value {
                font-size: 1.5rem;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/admin-dashboard.html" class="navbar-brand">
                <img src="data:image/svg+xml,%3Csvg width='180' height='80' viewBox='0 0 180 80' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='30' cy='40' r='25' fill='%23FDDB6F'/%3E%3Ccircle cx='30' cy='40' r='20' fill='%23FCA94B'/%3E%3Ccircle cx='30' cy='40' r='15' fill='%23F58220'/%3E%3Ccircle cx='30' cy='40' r='10' fill='%23EA532F'/%3E%3Ccircle cx='30' cy='40' r='6' fill='%2300205B'/%3E%3Ctext x='68' y='52' font-family='Arial, sans-serif' font-size='32' font-weight='bold' fill='%2300205B'%3EOando%3C/text%3E%3C/svg%3E" alt="Oando" class="logo">
            </a>
            <div class="navbar-menu"></div>
            <div class="navbar-user"></div>
            <button class="menu-toggle">‚ò∞</button>
        </div>
    </nav>

    <main class="page-content container">
        <div class="analytics-header">
            <h1>üìä Analytics Dashboard</h1>
            <p>Enterprise-grade insights into material requests, costs, and operational trends</p>
        </div>

        <div id="alertContainer"></div>

        <!-- Material Search Section -->
        <div class="search-section">
            <h3>üîç Material Search & Analysis</h3>
            <div class="search-container">
                <input 
                    type="text" 
                    id="materialSearchInput" 
                    class="search-input" 
                    placeholder="Search for any material (e.g., 'valve', 'pump', 'gasket')..."
                >
                <button id="materialSearchBtn" class="btn btn-primary">Search Material</button>
            </div>
            <p style="margin: 0.75rem 0 0 0; font-size: 0.8125rem; color: #737373;">
                Get detailed analytics including request frequency, location distribution, and value across all areas
            </p>
        </div>

        <!-- Advanced Filters -->
        <div class="filters-section">
            <h3>üéõÔ∏è Filters</h3>
            <div class="form-row form-row-3">
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <select id="filterLocation" class="form-select">
                        <option value="">All Locations</option>
                        <option value="Land Area">Land Area</option>
                        <option value="Swamp Area">Swamp Area</option>
                        <option value="PHC">PHC POD</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Discipline</label>
                    <select id="filterDiscipline" class="form-select">
                        <option value="">All Disciplines</option>
                        <option value="MECHANICAL">MECHANICAL</option>
                        <option value="ELECTRICAL">ELECTRICAL</option>
                        <option value="INSTRUMENT">INSTRUMENT</option>
                        <option value="GMC">GMC</option>
                        <option value="ASSET INTEGRITY">ASSET INTEGRITY</option>
                        <option value="SERVICE">SERVICE</option>
                        <option value="ROT EQUIPMENT">ROT EQUIPMENT</option>
                        <option value="others">others</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">From Date</label>
                    <input type="date" id="filterFrom" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">To Date</label>
                    <input type="date" id="filterTo" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Year</label>
                    <select id="filterYear" class="form-select">
                        <option value="">All Years</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Month</label>
                    <select id="filterMonth" class="form-select">
                        <option value="">All Months</option>
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end;">
                    <button onclick="applyFilters()" class="btn btn-primary" style="width: 100%;">Apply Filters</button>
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end;">
                    <button onclick="resetFilters()" class="btn btn-outline" style="width: 100%;">Reset</button>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="kpi-card" style="border-left-color: #00205B;">
                <div class="kpi-label">Total Requests</div>
                <div class="kpi-value" id="statTotal">0</div>
            </div>
            <div class="kpi-card" style="border-left-color: #F58220;">
                <div class="kpi-label">Awaiting Approval</div>
                <div class="kpi-value" id="statAwaitingApproval">0</div>
            </div>
            <div class="kpi-card" style="border-left-color: #f97316;">
                <div class="kpi-label">Awaiting Quotation</div>
                <div class="kpi-value" id="statAwaitingQuotation">0</div>
            </div>
            <div class="kpi-card" style="border-left-color: #10b981;">
                <div class="kpi-label">Materials Delivered</div>
                <div class="kpi-value" id="statDelivered">0</div>
            </div>
            <div class="kpi-card" style="border-left-color: #3b82f6;">
                <div class="kpi-label">Closed Requests</div>
                <div class="kpi-value" id="statClosed">0</div>
            </div>
            <div class="kpi-card" style="border-left-color: #8b5cf6;">
                <div class="kpi-label">Avg Requests / Month</div>
                <div class="kpi-value" style="color: #8b5cf6; font-size: 1.75rem;" id="statAvgPerMonth">0</div>
            </div>
        </div>

        <!-- Month in Focus -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body">
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; margin-bottom: 1.25rem;">
                    <div style="flex: 1 1 240px;">
                        <label class="form-label">Month in Focus</label>
                        <select id="monthFocusSelect" class="form-select">
                            <option value="">Select a month</option>
                        </select>
                    </div>
                    <div style="flex: 1 1 240px;">
                        <label class="form-label">Quick Note</label>
                        <div id="monthFocusHint" style="font-size: 0.875rem; color: #525252;">Pick a month (e.g. June) to see tailored insights.</div>
                    </div>
                    <div style="flex: 0 0 220px; display: flex; align-items: flex-end;">
                        <button id="refreshAnalyticsBtn" class="btn btn-outline" style="width: 100%;">üîÅ Refresh Analytics</button>
                    </div>
                </div>
                <div id="monthFocusCards" class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                    <div class="kpi-card" style="border-left-color: #00205B;">
                        <div class="kpi-label">Requests</div>
                        <div class="kpi-value" id="monthFocusRequests">‚Äî</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #F58220;">
                        <div class="kpi-label">Total Quantity</div>
                        <div class="kpi-value" id="monthFocusQuantity">‚Äî</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #10b981;">
                        <div class="kpi-label">Avg Qty / Request</div>
                        <div class="kpi-value" id="monthFocusValue">‚Äî</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: #3b82f6;">
                        <div class="kpi-label">Focus Window</div>
                        <div class="kpi-value" id="monthFocusAvg">‚Äî</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem;">
            <div class="chart-card">
                <h3>üìà Monthly Request Trend</h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>
                    <span>üîß Top 6 Disciplines</span>
                </h3>
                <div class="chart-container">
                    <canvas id="disciplineChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Status Overview -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <h3>üìã Status Mix</h3>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- Year Comparison -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <h3>üìÜ Year-on-Year Request Trend (2024 - 2025)</h3>
            <div class="chart-container chart-container-large">
                <canvas id="yearComparisonChart"></canvas>
            </div>
        </div>

        <!-- Location Spotlight -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">üìç Location Spotlight</h3>
                <select id="locationSpotlightSelect" class="form-select" style="max-width: 250px;">
                    <option value="">Select Location</option>
                </select>
            </div>
            <div id="locationSpotlightStats" class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                <div class="kpi-card" style="border-left-color: #00205B;">
                    <div class="kpi-label">Total Requests</div>
                    <div class="kpi-value" id="locationSpotlightRequests">‚Äî</div>
                </div>
                <div class="kpi-card" style="border-left-color: #F58220;">
                    <div class="kpi-label">Total Quantity</div>
                    <div class="kpi-value" id="locationSpotlightQuantity">‚Äî</div>
                </div>
                <div class="kpi-card" style="border-left-color: #3b82f6;">
                    <div class="kpi-label">Top Material</div>
                    <div class="kpi-value" id="locationSpotlightTopMaterial">‚Äî</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="locationSpotlightTrend"></canvas>
            </div>
            <div style="margin-top: 1.5rem;">
                <h4 style="color: #00205B; font-size: 1rem; margin-bottom: 0.75rem;">üì¶ Priority Materials</h4>
                <div class="material-breakdown-table" style="max-height: 300px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Total Qty</th>
                                <th>Unit</th>
                                <th>Requests</th>
                            </tr>
                        </thead>
                        <tbody id="locationTopMaterialsBody">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 1rem; color: #737373;">Select a location to view insights</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Month Discipline Chart -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <h3>üõ† Discipline Mix for Selected Month</h3>
            <div class="chart-container" data-month-discipline-container>
                <canvas id="monthDisciplineChart"></canvas>
            </div>
        </div>

        <!-- Location Chart - Full Width & Larger -->
        <div style="display: grid; grid-template-columns: 1fr; gap: 2rem; margin-bottom: 2rem;">
            <div class="chart-card">
                <h3>
                    <span>üìç Location Distribution</span>
                    <button id="toggleLocationBtn" onclick="toggleLocationChart()" class="toggle-chart-btn">
                        üìä Bar View
                    </button>
                </h3>
                <div class="chart-container chart-container-large">
                    <canvas id="locationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Top Materials Chart - Full Width -->
        <div style="display: grid; grid-template-columns: 1fr; gap: 2rem; margin-bottom: 2rem;">
            <div class="chart-card">
                <h3>üì¶ Top 15 Materials by Quantity</h3>
                <div class="chart-container chart-container-large">
                    <canvas id="materialsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Vendor Leaderboard -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <h3>ü§ù Top Vendors by Engagement</h3>
            <div class="material-breakdown-table" style="max-height: 400px;">
                <table>
                    <thead>
                        <tr>
                            <th>Vendor</th>
                            <th>Requests</th>
                            <th>Total Quantity</th>
                        </tr>
                    </thead>
                    <tbody id="vendorLeaderboardBody">
                        <tr>
                            <td colspan="3" style="text-align: center; padding: 1.5rem; color: #737373;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Material Breakdown Table -->
        <div class="chart-card" style="margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0; border: none; padding: 0;">üìã Complete Material Breakdown</h3>
                <button onclick="exportMaterialBreakdown()" class="btn btn-secondary btn-sm">üì• Export CSV</button>
            </div>
            <div class="material-breakdown-table">
                <table>
                    <thead>
                        <tr>
                            <th>Material Description</th>
                            <th>Total Quantity</th>
                            <th>Unit</th>
                            <th>Requests</th>
                            <th>Locations</th>
                        </tr>
                    </thead>
                    <tbody id="materialBreakdownBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem; color: #737373;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="text-align: center; padding: 2rem; color: #737373; font-size: 0.8125rem;">
            <p>üîÅ Click "Refresh Data" anytime for the latest snapshot. Analytics powered by Oando brand intelligence.</p>
        </div>
    </main>

    <script src="assets/js/app.js"></script>
    <script src="assets/js/analytics.js"></script>
</body>
</html>